name: AutoMerge

on:
  schedule:
    - cron: '*/5 * * * *'

jobs:
  job1:
    if: github.event.schedule == '*/5 * * * *'
    runs-on: ubuntu-latest
    steps:
      - name: Get current day
        uses: 1466587594/get-current-time@v1
        id: current-time
        with:
          format: YYYY-MM-DD
      - name: Set ENV
        run: |
          echo "::set-env name=LABELS::${{ steps.current-time.outputs.formattedTime }},lala"
      - name: Merge if follow conditions
        uses: pascalgn/automerge-action@v0.8.3
        env:
          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
          LABELS: 'automerge,*/5 * * * *,"${{ env.F_TIME }}"' 
          MERGE_LABELS: "${{ env.LABELS }}"
          MERGE_DELETE_BRANCH: true
          F_TIME: "${{ steps.current-time.outputs.formattedTime }}"
        #if: contains( toJson(github), '2020-05-28' )
        #if: contains( github.event.pull_request.labels.*.name, '2020-05-28' )
    
#      - name: automerge
#        uses: pascalgn/automerge-action@v0.8.3
#        env:
#          GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
#          MERGE_LABELS: "automerge"
#          MERGE_DELETE_BRANCH: true
